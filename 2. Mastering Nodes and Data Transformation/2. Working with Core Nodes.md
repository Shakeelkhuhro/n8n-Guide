# Working with Core Nodes: HTTP Request, Set, and Function

The HTTP Request, Set, and Function nodes are fundamental building blocks in n8n, enabling you to interact with external APIs, manipulate data, and execute custom JavaScript code within your workflows. Mastering these nodes is crucial for building complex and versatile automations. This lesson will provide a comprehensive understanding of each node, equipping you with the knowledge to effectively utilize them in your n8n workflows.

## The HTTP Request Node: Interacting with the Web

The HTTP Request node allows your n8n workflows to communicate with web services and APIs. It can send various types of HTTP requests (GET, POST, PUT, DELETE, etc.) and retrieve data from external sources. This node is essential for integrating with third-party applications, fetching data from websites, and triggering actions in other systems.

### Understanding HTTP Methods

Different HTTP methods are used to perform different actions on a resource. Here's a breakdown of the most common methods:

- **GET**: Retrieves data from a specified resource. It's the most common method and is used for reading data. Example: Fetching a user's profile from an API.
- **POST**: Sends data to a server to create or update a resource. Example: Submitting a form on a website or creating a new record in a database.
- **PUT**: Replaces an existing resource with the data provided in the request. Example: Updating a user's profile with new information.
- **DELETE**: Deletes a specified resource. Example: Removing a user account from a system.
- **PATCH**: Applies partial modifications to a resource. This is useful when you only want to update specific fields of a resource. Example: Changing a user's email address without modifying other profile details.

### Configuring the HTTP Request Node

To use the HTTP Request node, you need to configure several parameters:

- **URL**: The URL of the API endpoint or web service you want to interact with.
- **Method**: The HTTP method to use (GET, POST, PUT, DELETE, etc.).
- **Headers**: HTTP headers to include in the request. Headers provide additional information about the request, such as the content type or authorization credentials.
- **Query Parameters**: Parameters to include in the URL. These are typically used with GET requests to filter or sort data.
- **Body**: The data to send in the request body. This is typically used with POST, PUT, and PATCH requests. The body can be in various formats, such as JSON, XML, or plain text.
- **Authentication**: Credentials to use for authentication, such as API keys or OAuth tokens.

### Example: Fetching Data from a REST API

Let's say you want to fetch data from a public REST API, such as the JSONPlaceholder API, which provides sample data for testing purposes. Here's how you can configure the HTTP Request node to fetch a list of posts:

1. Add an HTTP Request node to your workflow.
2. Set the URL to `https://jsonplaceholder.typicode.com/posts`.
3. Set the Method to `GET`.
4. Leave the Headers and Body fields empty.
5. Execute the node.

The node will send a GET request to the specified URL and retrieve a JSON array of posts. The output of the node will be an array of items, where each item represents a post.

### Example: Sending Data to an API

Now, let's say you want to send data to an API using the POST method. You can use the same JSONPlaceholder API to create a new post. Here's how you can configure the HTTP Request node:

1. Add an HTTP Request node to your workflow.
2. Set the URL to `https://jsonplaceholder.typicode.com/posts`.
3. Set the Method to `POST`.
4. Set the Headers to include a `Content-Type` header with the value `application/json`. This tells the API that you're sending JSON data.
5. Set the Body to a JSON object representing the new post. For example:

```json
{
  "title": "My New Post",
  "body": "This is the body of my new post.",
  "userId": 1
}
```

6. Execute the node.

The node will send a POST request to the specified URL with the JSON data in the request body. The API will create a new post and return a JSON object representing the newly created post.

### Handling Different Response Types

The HTTP Request node can handle various response types, such as JSON, XML, and plain text. The node automatically parses JSON responses and makes the data available as JavaScript objects. For other response types, you may need to use the Function node to parse the data manually.

### Error Handling with the HTTP Request Node

It's important to handle errors when making HTTP requests. The HTTP Request node provides options for handling different types of errors, such as network errors, server errors, and authentication errors. You can use the Try/Catch node (which will be covered in a later lesson) to catch errors and handle them gracefully.

## The Set Node: Manipulating Data

The Set node allows you to modify the data that flows through your workflow. You can use it to add new fields, update existing fields, or remove fields from the data. This node is essential for transforming data into the desired format for subsequent nodes.

### Setting Values

The primary function of the Set node is to set the value of a field. You can set the value to a static value, an expression, or the value of another field.

#### Example: Setting a static value

Let's say you have a workflow that retrieves data from an API, and you want to add a new field called `status` with the value `active`. You can use the Set node to achieve this:

1. Add a Set node to your workflow.
2. In the Fields section, add a new field with the name `status`.
3. Set the Value to `active`.
4. Execute the node.

The node will add a new field called `status` to each item in the data, with the value `active`.

#### Example: Setting a value using an expression

You can also use expressions to set the value of a field. Expressions allow you to perform calculations, manipulate strings, and access data from other fields.

Let's say you have a field called `firstName` and a field called `lastName`, and you want to create a new field called `fullName` that contains the concatenation of the two fields. You can use the following expression:

```
{{$json.firstName}} {{$json.lastName}}
```

1. Add a Set node to your workflow.
2. In the Fields section, add a new field with the name `fullName`.
3. Set the Value to the expression above.
4. Execute the node.

The node will create a new field called `fullName` for each item in the data, with the value being the concatenation of the `firstName` and `lastName` fields.

### Moving and Merging Data

The Set node can also move data between fields or merge data from multiple fields into one.

#### Example: Moving data

To move data from one field to another, you can set the value of the destination field to the value of the source field, and then remove the source field.

#### Example: Merging data

To merge data from multiple fields into one, you can use an expression that concatenates the values of the fields.

### Data Type Conversion

The Set node can also be used to convert data from one type to another. For example, you can convert a string to a number, or a number to a string.

#### Example: Converting a string to a number

Let's say you have a field called `price` that contains a string representation of a number, and you want to convert it to a number data type. You can use the following expression:

```
{{Number($json.price)}}
```

1. Add a Set node to your workflow.
2. In the Fields section, add a new field with the name `price` (overwriting the existing one).
3. Set the Value to the expression above.
4. Execute the node.

The node will convert the `price` field to a number data type.

### Removing Fields

Sometimes, you may want to remove fields from the data. The Set node allows you to do this by setting the value of the field to `null`.

#### Example: Removing a field

Let's say you want to remove the `firstName` field from the data. You can use the following steps:

1. Add a Set node to your workflow.
2. In the Fields section, add a new field with the name `firstName`.
3. Set the Value to `null`.
4. Execute the node.

The node will remove the `firstName` field from the data.

## The Function Node: Executing Custom JavaScript Code

The Function node allows you to execute custom JavaScript code within your n8n workflows. This node is incredibly powerful, as it allows you to perform complex data transformations, implement custom logic, and integrate with external libraries.

### Writing JavaScript Code in the Function Node

The Function node provides a code editor where you can write JavaScript code. The code you write will be executed for each item in the data that flows through the node.

### Accessing Input Data

Within the Function node, you can access the input data using the `items` array. Each element in the `items` array represents an item in the data. You can access the data of each item using the `$json` property.

#### Example: Accessing input data

Let's say you have a workflow that retrieves data from an API, and you want to access the `title` field of each item. You can use the following code:

```javascript
for (let i = 0; i < items.length; i++) {
  const title = items[i].$json.title;
  console.log(title);
}
return items;
```

### Modifying Data

You can modify the data within the Function node by modifying the `$json` property of each item.

#### Example: Modifying data

Let's say you want to convert the `title` field of each item to uppercase. You can use the following code:

```javascript
for (let i = 0; i < items.length; i++) {
  items[i].$json.title = items[i].$json.title.toUpperCase();
}
return items;
```

### Adding New Data

You can add new data to each item by adding new properties to the `$json` object.

#### Example: Adding new data

Let's say you want to add a new field called `status` with the value `active` to each item. You can use the following code:

```javascript
for (let i = 0; i < items.length; i++) {
  items[i].$json.status = 'active';
}
return items;
```

### Returning Data

The Function node must return the modified `items` array. The returned data will be passed to the next node in the workflow.

### Using External Libraries

The Function node allows you to use external JavaScript libraries. You can import libraries using the `require()` function. However, keep in mind that not all libraries are compatible with n8n, and some libraries may require additional configuration.

### Error Handling in the Function Node

It's important to handle errors in the Function node. You can use the `try...catch` statement to catch errors and handle them gracefully.

#### Example: Error handling

```javascript
try {
  for (let i = 0; i < items.length; i++) {
    items[i].$json.title = items[i].$json.title.toUpperCase();
  }
  return items;
} catch (error) {
  console.error(error);
  // Handle the error, e.g., by setting a default value or logging the error.
  return items;
}
```

## Exercises

* **HTTP Request Node**: Create a workflow that fetches a random joke from the icanhazdadjoke API and logs it to the console.
* **Set Node**: Create a workflow that retrieves a user's information (first name, last name, email) and then creates a new field called `initials` containing the user's first and last name initials.
* **Function Node**: Create a workflow that takes a list of numbers and returns a new list containing only the even numbers.
* **Combining Nodes**: Create a workflow that uses the HTTP Request node to fetch a list of products from an e-commerce API, then uses the Function node to filter the products based on their price (e.g., only products with a price greater than \$100), and finally uses the Set node to add a new field called `discountedPrice` with a 10% discount applied.

## Summary

In this lesson, we explored three core nodes in n8n: the HTTP Request node, the Set node, and the Function node. The HTTP Request node allows you to interact with external APIs and web services. The Set node enables you to manipulate data by adding, updating, or removing fields. The Function node provides a way to execute custom JavaScript code within your workflows. Mastering these nodes is essential for building complex and versatile automations.

In the next lesson, we will delve deeper into data transformation techniques, focusing on expressions and JavaScript. We will explore how to use expressions to perform calculations, manipulate strings, and access data from other fields. We will also learn how to use JavaScript to implement more complex data transformations.
